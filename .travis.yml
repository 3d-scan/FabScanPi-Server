dist: trusty
language: python
python:
- 2.7_with_system_site_packages
before_install:
- sudo apt-get -qq update
- sudo apt-get install -y build-essential python-setuptools debhelper cdbs dh-python python-pip rsync 
before_script: pip install mkdocs
script: make deb
after_success:
- curl -T ../*.deb -u $FTPUSER:$FTPPASSWORD ftp://mariolukas.de/build/
- NOW=`date +%Y-%m-%d-%H-%M`
- mkdocs build
- cd ..
- mkdir tmp
- cd tmp
- git clone -b gh-pages https://github.com/mariolukas/FabScanPi-Server.git
- cd FabScanPi-Server
- git config --global user.email "dev@fabscan.org"
- git config --global user.name "Travis CI"
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GITHUB_TOKEN}:@github.com" > .git/credentials
- rsync -a -v ../../FabScanPi-Server/site/ .
- git commit -am "travis doc update ${NOW}"
- git push
- cd ../../FabScanPi-Server/
env:
  global:
  - secure: "VM0QmL36SDkwoxrGgZrHGlVyaa8+J16CT37nHr1P2ofXjj3ByfMNL8Ewd42nHCxuiBitNMpsNlB8Y5OrBr5LNhub7tUd4E0FvevVQsWLgILLpd5w1r9mufOrkzcRPEDMQTuaQ0t5rO5gIeckbpdo1E0TPP9V9eE/doNgyYzQqBFJUXQ0J0WaHuA0tWFr/SwJ1qgYP5RPWJ9MhK/RFxlsYOABIZSwlAdOJB3xlMqZhgHSjd9UwxgiPJLJcL/dWmN2hylCf8rNjmdvDvaYWW9xq2PzpLA2WGQHBhk1KRNIDPiZKSu8whBXwXBGHyINFjlfnSEH3g9FJTlOWXdcNTAIIfCywZuJDNk3aGd9jyuDrqfPsLfh/ur1PHgypNy0zFbWaRWlgEdDMs2HL6Kli8W6qPB6S/DGUmq+8R1PE9gtsRbmr6EvPs6dBEBQMNTmndGmr6WGMbJxtsyJxZzhbwVGbqLOFv3xG/qLyfPNKVoPOtml1fJ068LFRxRtMkBPU6dOpPqruu5qbRKYYQrDClNLDqZcVWGRQWpKL3tVqP3pFm5ztgNPBxVqHPZvXwAdkjb0ZeTATYvN5PSbgbVtFG5AkGIsKk+wyDlGq8P5SaRtqN8y+PMmSV1AmCzSR1xLTjf7tKnuzMTcqU8EApv8dyLDeDSXfMLomcOpzODiCdJlu+U="
  - secure: "jydeEj8jBFXcsdxIrJoYcsByA8smA4iYxs+jdcUqACgBTORcAppjL3HblLqUO4s5RTmEb+nSdiJM+Mv0pzmiWKJpheOqfy4tUiM+3XRqzb+Vc6Q9OInEhep/rX8Sn8o2J+cceyi1SSh/O2NHQzUW4tqqQaBR6eINcaJjHXdOopD3OQkXZnJQ8jVDS/t1c+y1bNtvELZTq5BUtleGUTP4v8USkpotoF7J7kdAT69o4Y6QMW+gfjX5JroLRj5wC9zLs/R9zFkMqJSDa4fnayAyo6vY/1HNUsFSoDs0y2d4SKdlM6uB5SmeOd0cJlRmlk81U/OyBGlkUuTmfTRTU4CkEDfQoQ4dwmmFv1N7QDlGR/aCAKYUrCEiiNbSjgSgK0UrquUaAxk7UGRWBq1dDJtjbI/yqy/QezB+YYBfqIXKUkqiL64d++4zLwNgQ+mxIUrIEdoIEdd5iBsufEcFjMwzsiUtayUXKhWsF9bWiTmY92FKHTVhvzwHkhDfJixRcFLAjQFb0H1jo9yLXEeww8/urXHMEg3Z7zsp7tfPyc60CWBAv2DenymHA4s19ylm+poXx/D2RGm8VGO+3kCSMft213+pVw977rGt3yql+fz7sZJj02ZL5gG7FwlA5X3vimxoNwB80rcLZfYPaCm+lIT2icCUOQyHOlMiXGomanTDER0="
  - secure: "iKV7rjdri+dxUlyr0C01195QFREbfIt0nL1ocdMrxDZdp8hb25pDl3UPrbC8pBSHIfOvbucfN7BMukS4EsD3Jxw0YCInwwUR5hZRZkiegU5TuUdzKHpbSCHl8+gtv9IcQKSYryHeFGAtCnW+52XIlNkLH8pzjKJyLkMB/uIVDdcQn1az7t8MR21ucTJdyGf/oJBmabmq9nwqEgumA+Ei+6J+/jdzK+M3do1iON1yHFJS2yGU21QdRIRxvEIat8Ss6JV/nfWFMbWQH/YRHKTrMXkgscqgDB/hJtfDgIvlObgsssrScRSoOm3a7vKEn4OoefUV0oFsPBrCKYEjWMqyEutz/nX25bV2gytrKbzyurI8Qr1QMJhcFZiobLkhMWTyAS/lJqQl45/Ffxj2pJFiUXvKCz+dwKYaQ/zjAu2ZUhxFw4f7KR7yTz3ifQFHy6imZ/1P/J7LLLiMXENN2xQCP80nsuLdRVFFms3z/nSbm/dLosudWHWu+x0tdbMd9XswfRqcaAr2WePNbGLAzb3mivKoP1hIG7yMVgc6dnLWoH2QPtcSdwSsBkkUZPMMRrk4Hy1GqYGPrqJ+CuHhffRKlnL+Irj3uMO0Uxxl0w/YK6h4UJu6bnvIsLIKNR84ZeoQqm8q10tXOZrlInAYYfYthRumBzNNNeCfneTHeqRL/PI="
before_deploy:
- export RELEASE_FILE_NAME=$(ls ../*.deb)
after_deploy: 
- curl -T ../*.deb -u $FTPUSER:$FTPPASSWORD ftp://mariolukas.de/deploy/
- NOW=`date +%Y-%m-%d-%H-%M`
- cd ..
- git clone https://github.com/mariolukas/FabScanPi-Build-Raspbian.git
- cd FabScanPi-Build-Raspbian
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git tag v.${NOW} -m "new release ${RELEASE_FILE_NAME}"
- git push origin --tags
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
  - secure: "iKV7rjdri+dxUlyr0C01195QFREbfIt0nL1ocdMrxDZdp8hb25pDl3UPrbC8pBSHIfOvbucfN7BMukS4EsD3Jxw0YCInwwUR5hZRZkiegU5TuUdzKHpbSCHl8+gtv9IcQKSYryHeFGAtCnW+52XIlNkLH8pzjKJyLkMB/uIVDdcQn1az7t8MR21ucTJdyGf/oJBmabmq9nwqEgumA+Ei+6J+/jdzK+M3do1iON1yHFJS2yGU21QdRIRxvEIat8Ss6JV/nfWFMbWQH/YRHKTrMXkgscqgDB/hJtfDgIvlObgsssrScRSoOm3a7vKEn4OoefUV0oFsPBrCKYEjWMqyEutz/nX25bV2gytrKbzyurI8Qr1QMJhcFZiobLkhMWTyAS/lJqQl45/Ffxj2pJFiUXvKCz+dwKYaQ/zjAu2ZUhxFw4f7KR7yTz3ifQFHy6imZ/1P/J7LLLiMXENN2xQCP80nsuLdRVFFms3z/nSbm/dLosudWHWu+x0tdbMd9XswfRqcaAr2WePNbGLAzb3mivKoP1hIG7yMVgc6dnLWoH2QPtcSdwSsBkkUZPMMRrk4Hy1GqYGPrqJ+CuHhffRKlnL+Irj3uMO0Uxxl0w/YK6h4UJu6bnvIsLIKNR84ZeoQqm8q10tXOZrlInAYYfYthRumBzNNNeCfneTHeqRL/PI="
  file_glob: true
  file: "${RELEASE_FILE_NAME}"
  on:
    tags: true
    repo: mariolukas/FabScanPi-Server
